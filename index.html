<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulBuddy - Chat & Self-Discovery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .tab-content { display: none; height: calc(100vh - 140px); }
        .tab-content.active { display: flex; }
        .chat-bubble { max-width: 85%; border-radius: 1.25rem; }
        .user-bubble { border-bottom-right-radius: 0.25rem; }
        .ai-bubble { border-bottom-left-radius: 0.25rem; }
        
        #chat-area::-webkit-scrollbar { width: 4px; }
        #chat-area::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .typing-indicator { animation: pulse-soft 1.5s infinite; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-slate-100">

    <div id="main-app" class="w-full max-w-md bg-white h-screen md:h-[750px] md:rounded-[2.5rem] shadow-2xl flex flex-col overflow-hidden relative border border-white">
        
        <!-- Header -->
        <header class="px-6 py-5 flex justify-between items-center bg-white/80 backdrop-blur-md sticky top-0 z-20">
            <div>
                <h1 id="header-title" class="text-xl font-bold text-slate-900">SoulBuddy</h1>
                <p id="header-subtitle" class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest">Teman Setia Kamu</p>
            </div>
            <div class="w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
            </div>
        </header>

        <!-- Tab 1: Chat (Curhat) -->
        <div id="tab-chat" class="tab-content active flex-col">
            <div id="chat-area" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50">
                <div class="flex justify-start">
                    <div class="ai-bubble bg-white border border-slate-100 p-4 text-sm text-slate-700 shadow-sm">
                        Halo! Aku SoulBuddy. Apapun yang mengganjal di hatimu, ceritakan saja ya. Aku di sini untuk mendengarkan tanpa menghakimi. ðŸ˜Š
                    </div>
                </div>
            </div>
            
            <div id="typing" class="hidden px-6 py-2">
                <p class="text-[11px] text-slate-400 italic flex items-center gap-2">
                    <span class="w-1.5 h-1.5 bg-indigo-400 rounded-full typing-indicator"></span>
                    SoulBuddy sedang memikirkan balasan...
                </p>
            </div>

            <div class="p-4 bg-white border-t border-slate-100">
                <div class="flex items-center gap-2 bg-slate-100 rounded-2xl px-4 py-2">
                    <input type="text" id="user-input" placeholder="Ketik curhatanmu..." class="flex-1 bg-transparent border-none outline-none py-2 text-sm text-slate-700">
                    <button id="send-btn" class="text-indigo-600 p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab 2: Tes Diri -->
        <div id="tab-test" class="tab-content flex-col p-6 overflow-y-auto bg-white">
            <h2 class="text-lg font-bold text-slate-800 mb-2">Kenali Dirimu Lebih Dalam</h2>
            <p class="text-xs text-slate-500 mb-6">Analisis mendalam dengan 15 pertanyaan.</p>

            <div class="space-y-4" id="test-list">
                <!-- Mood Test -->
                <button onclick="startTest('mood')" class="w-full text-left p-4 rounded-3xl border border-slate-100 bg-slate-50 hover:bg-indigo-50 transition-all">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-2xl bg-orange-100 flex items-center justify-center text-orange-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-slate-800 text-sm">Cek Suasana Hati (Mood)</h3>
                            <p class="text-[11px] text-slate-500 mt-1">Evaluasi kestabilan emosi kamu saat ini.</p>
                        </div>
                    </div>
                </button>

                <!-- Personality Test -->
                <button onclick="startTest('personality')" class="w-full text-left p-4 rounded-3xl border border-slate-100 bg-slate-50 hover:bg-indigo-50 transition-all">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-2xl bg-blue-100 flex items-center justify-center text-blue-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-slate-800 text-sm">Introvert vs Ekstrovert</h3>
                            <p class="text-[11px] text-slate-500 mt-1">Cari tahu kecenderungan energi sosialmu.</p>
                        </div>
                    </div>
                </button>

                <!-- Stress Test -->
                <button onclick="startTest('stress')" class="w-full text-left p-4 rounded-3xl border border-slate-100 bg-slate-50 hover:bg-indigo-50 transition-all">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-2xl bg-rose-100 flex items-center justify-center text-rose-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-slate-800 text-sm">Tingkat Stres</h3>
                            <p class="text-[11px] text-slate-500 mt-1">Ukur tekanan pikiran yang kamu alami.</p>
                        </div>
                    </div>
                </button>
            </div>

            <div id="quiz-container" class="hidden space-y-6 mt-4">
                <div class="bg-indigo-600 rounded-3xl p-6 text-white">
                    <p id="quiz-progress" class="text-[10px] uppercase tracking-widest opacity-70 mb-2">Soal 1 dari 15</p>
                    <h3 id="quiz-question" class="font-bold text-lg leading-tight">...</h3>
                </div>
                <div id="quiz-options" class="space-y-3"></div>
                <button onclick="cancelTest()" class="w-full py-3 text-sm font-medium text-slate-400">Batal</button>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="h-20 bg-white border-t border-slate-100 flex items-center justify-around px-8 sticky bottom-0">
            <button onclick="switchTab('chat')" id="nav-chat" class="flex flex-col items-center gap-1 text-indigo-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                <span class="text-[10px] font-bold">Curhat</span>
            </button>
            <button onclick="switchTab('test')" id="nav-test" class="flex flex-col items-center gap-1 text-slate-400">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                <span class="text-[10px] font-bold">Tes Diri</span>
            </button>
        </nav>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-6 text-center max-h-[90vh] overflow-y-auto">
            <div id="result-icon" class="w-16 h-16 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mx-auto mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2v20"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">Analisa Kamu</h3>
            
            <div class="text-left bg-slate-50 rounded-2xl p-4 mb-4">
                <p class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest mb-1">Tipe Hasil</p>
                <p id="result-text" class="text-lg font-bold text-indigo-700 mb-3">...</p>
                
                <p class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest mb-1">Analisis SoulBuddy</p>
                <p id="result-analysis" class="text-xs text-slate-600 mb-4 leading-relaxed">...</p>
                
                <p class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest mb-2">Saran Kegiatan</p>
                <ul id="result-suggestions" class="text-xs text-slate-600 list-disc list-inside space-y-2"></ul>
            </div>
            
            <button onclick="closeResult()" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg">Selesai</button>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        const chatArea = document.getElementById('chat-area');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing');

        // State Management
        let currentQuizType = '';
        let currentStep = 0;
        let score = 0;

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            const navChat = document.getElementById('nav-chat');
            const navTest = document.getElementById('nav-test');

            if (tab === 'chat') {
                navChat.className = "flex flex-col items-center gap-1 text-indigo-600";
                navTest.className = "flex flex-col items-center gap-1 text-slate-400";
            } else {
                navTest.className = "flex flex-col items-center gap-1 text-indigo-600";
                navChat.className = "flex flex-col items-center gap-1 text-slate-400";
                cancelTest();
            }
        }

        // Chat Logic
        async function fetchAI(prompt) {
            const system = "Kamu adalah SoulBuddy, asisten psikologi yang sangat empatik dan hangat. Gunakan bahasa Indonesia santai (seperti sahabat).";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: system }] }
                    })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "SoulBuddy selalu di sini mendengarkanmu.";
            } catch (e) {
                return "Jaringan agak sibuk, tapi ceritakan saja terus ya.";
            }
        }

        async function handleSend() {
            const text = userInput.value.trim();
            if (!text) return;
            addBubble('user', text);
            userInput.value = '';
            typingIndicator.classList.remove('hidden');
            const response = await fetchAI(text);
            typingIndicator.classList.add('hidden');
            addBubble('ai', response);
        }

        function addBubble(role, text) {
            const wrapper = document.createElement('div');
            wrapper.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} w-full`;
            const div = document.createElement('div');
            div.className = `chat-bubble p-4 text-sm font-medium shadow-sm ${role === 'user' ? 'user-bubble bg-indigo-600 text-white' : 'ai-bubble bg-white border border-slate-100 text-slate-700'}`;
            div.textContent = text;
            wrapper.appendChild(div);
            chatArea.appendChild(wrapper);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        sendBtn.addEventListener('click', handleSend);
        userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleSend(); });

        // Quiz Data
        const commonOptions = ["Sangat Setuju", "Setuju", "Tidak Setuju", "Sangat Tidak Setuju"];
        const quizzes = {
            mood: [
                { q: "Saya merasa optimis hari ini.", a: commonOptions },
                { q: "Energi saya stabil dari pagi hingga sekarang.", a: commonOptions },
                { q: "Saya tidak merasa terbebani oleh pikiran kecil.", a: commonOptions },
                { q: "Saya merasa dihargai oleh lingkungan.", a: commonOptions },
                { q: "Saya merasa senang melakukan tugas saya.", a: commonOptions },
                { q: "Saya mudah tersenyum kepada orang lain.", a: commonOptions },
                { q: "Tidur saya nyenyak semalam.", a: commonOptions },
                { q: "Saya merasa hari ini akan berjalan baik.", a: commonOptions },
                { q: "Saya tidak merasa cemas tanpa alasan.", a: commonOptions },
                { q: "Saya merasa bisa mengendalikan emosi saya.", a: commonOptions },
                { q: "Saya merasa puas dengan diri saya saat ini.", a: commonOptions },
                { q: "Saya merasa terhubung dengan teman/keluarga.", a: commonOptions },
                { q: "Saya bisa fokus pada pekerjaan/belajar.", a: commonOptions },
                { q: "Saya merasa tubuh saya bugar.", a: commonOptions },
                { q: "Secara umum, saya bahagia hari ini.", a: commonOptions }
            ],
            personality: [
                { q: "Saya merasa berenergi setelah berkumpul dengan banyak orang.", a: commonOptions },
                { q: "Saya lebih suka berbicara daripada mendengarkan.", a: commonOptions },
                { q: "Saya sering memulai percakapan dengan orang asing.", a: commonOptions },
                { q: "Saya merasa bosan jika sendirian terlalu lama.", a: commonOptions },
                { q: "Saya lebih suka bekerja di kantor yang ramai.", a: commonOptions },
                { q: "Saya sering spontan dalam melakukan sesuatu.", a: commonOptions },
                { q: "Saya mudah mengekspresikan emosi secara terbuka.", a: commonOptions },
                { q: "Saya suka menjadi pusat perhatian dalam acara.", a: commonOptions },
                { q: "Saya memiliki jaringan pertemanan yang sangat luas.", a: commonOptions },
                { q: "Saya lebih suka telepon daripada chat.", a: commonOptions },
                { q: "Saya sering berpikir sambil berbicara.", a: commonOptions },
                { q: "Saya merasa nyaman dalam lingkungan yang berisik.", a: commonOptions },
                { q: "Saya suka mencoba kegiatan kelompok yang baru.", a: commonOptions },
                { q: "Saya jarang merasa lelah setelah pesta atau acara.", a: commonOptions },
                { q: "Saya lebih suka mendiskusikan masalah dengan orang lain segera.", a: commonOptions }
            ],
            stress: [
                { q: "Saya merasa leher dan bahu saya sering tegang.", a: commonOptions },
                { q: "Saya merasa waktu berjalan terlalu cepat dan tidak cukup.", a: commonOptions },
                { q: "Saya mudah merasa jengkel karena hal kecil.", a: commonOptions },
                { q: "Saya merasa sulit untuk bersantai.", a: commonOptions },
                { q: "Saya sering merasa kewalahan dengan tanggung jawab.", a: commonOptions },
                { q: "Nafsu makan saya tidak stabil.", a: commonOptions },
                { q: "Saya merasa khawatir tentang masa depan.", a: commonOptions },
                { q: "Saya merasa sulit mengambil keputusan.", a: commonOptions },
                { q: "Saya merasa tidak punya waktu untuk hobi.", a: commonOptions },
                { q: "Saya sering merasa lelah di pagi hari.", a: commonOptions },
                { q: "Saya merasa orang lain terlalu banyak menuntut saya.", a: commonOptions },
                { q: "Pikiran saya sulit berhenti bekerja saat istirahat.", a: commonOptions },
                { q: "Saya merasa terisolasi dari orang lain.", a: commonOptions },
                { q: "Saya merasa tidak bersemangat melakukan hal yang biasa saya sukai.", a: commonOptions },
                { q: "Saya merasa fisik saya melemah karena beban pikiran.", a: commonOptions }
            ]
        };

        function startTest(type) {
            currentQuizType = type;
            document.getElementById('test-list').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            currentStep = 0;
            score = 0;
            showQuestion();
        }

        function showQuestion() {
            const q = quizzes[currentQuizType][currentStep];
            document.getElementById('quiz-progress').innerText = `Soal ${currentStep + 1} dari 15`;
            document.getElementById('quiz-question').innerText = q.q;
            const options = document.getElementById('quiz-options');
            options.innerHTML = '';
            
            q.a.forEach((ans, i) => {
                const b = document.createElement('button');
                b.className = "w-full p-4 text-left text-sm border border-slate-100 bg-slate-50 rounded-2xl hover:bg-indigo-50";
                b.innerText = ans;
                b.onclick = () => { 
                    score += (4 - i); 
                    if(++currentStep < 15) showQuestion(); else showResult();
                };
                options.appendChild(b);
            });
        }

        function showResult() {
            const resText = document.getElementById('result-text');
            const resAnalysis = document.getElementById('result-analysis');
            const resSug = document.getElementById('result-suggestions');
            resSug.innerHTML = '';
            
            let title = "", analysis = "", sug = [];

            if (currentQuizType === 'personality') {
                if (score >= 48) {
                    title = "Ekstrovert";
                    analysis = "Kamu mendapatkan energi dengan berinteraksi bersama orang lain. Kamu ramah, terbuka, dan suka petualangan sosial.";
                    sug = ["Ikuti komunitas baru", "Ajak teman berdiskusi ide", "Ikuti kegiatan volunteer kelompok"];
                } else if (score >= 32) {
                    title = "Ambivert";
                    analysis = "Kamu memiliki keseimbangan yang baik antara interaksi sosial dan waktu sendiri. Kamu fleksibel dalam berbagai situasi.";
                    sug = ["Imbangi waktu keluar dengan me-time", "Coba hobi yang bisa dilakukan sendiri maupun kelompok", "Jaga keseimbangan energi harian"];
                } else {
                    title = "Introvert";
                    analysis = "Kamu memulihkan energi dengan ketenangan dan waktu sendiri. Kamu cenderung mendalam dalam berpikir dan selektif dalam bersosialisasi.";
                    sug = ["Menulis jurnal harian", "Membaca buku di tempat tenang", "Lakukan deep talk dengan satu teman dekat"];
                }
            } else if (currentQuizType === 'mood') {
                if (score >= 45) { title = "Mood Cerah"; analysis = "Emosimu sangat positif!"; sug = ["Berbagi keceriaan", "Mulai proyek baru"]; }
                else if (score >= 25) { title = "Mood Stabil"; analysis = "Emosimu cukup seimbang."; sug = ["Jalan sore santai", "Dengarkan musik"]; }
                else { title = "Mood Redup"; analysis = "Kamu mungkin butuh istirahat."; sug = ["Tidur lebih awal", "Curhat ke SoulBuddy"]; }
            } else {
                if (score >= 45) { title = "Stres Tinggi"; analysis = "Bebanmu cukup berat saat ini."; sug = ["Lakukan teknik napas dalam", "Konsultasi profesional"]; }
                else if (score >= 25) { title = "Stres Ringan"; analysis = "Ada sedikit tekanan rutin."; sug = ["Meditasi 5 menit", "Bereskan meja kerja"]; }
                else { title = "Sangat Rileks"; analysis = "Kamu sangat tenang."; sug = ["Pertahankan pola tidur", "Nikmati waktu senggang"]; }
            }

            resText.innerText = title;
            resAnalysis.innerText = analysis;
            sug.forEach(s => { const li = document.createElement('li'); li.innerText = s; resSug.appendChild(li); });
            document.getElementById('result-modal').classList.remove('hidden');
        }

        function closeResult() {
            document.getElementById('result-modal').classList.add('hidden');
            cancelTest();
        }

        function cancelTest() {
            document.getElementById('test-list').classList.remove('hidden');
            document.getElementById('quiz-container').classList.add('hidden');
        }
    </script>
</body>
</html>